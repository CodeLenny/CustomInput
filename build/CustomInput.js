// Generated by CoffeeScript 1.8.0
(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  define(["jquery", "CustomInput/Editor", "CustomInput/util/InputTypeList"], function($, Editor, InputTypeList) {
    var CustomInput;
    CustomInput = (function() {
      function CustomInput(checkPages, name, prefix) {
        if (checkPages == null) {
          checkPages = true;
        }
        if (name == null) {
          name = "CustomInput";
        }
        if (prefix == null) {
          prefix = "ci";
        }
        this.populateField = __bind(this.populateField, this);
        this.name = name;
        this.prefix = prefix;
        this.$ = $;
        this.jQuery = $;
        if (checkPages) {
          this.launch(window.location.pathname);
        }
      }

      CustomInput.prototype.isViewer = function(url) {
        return url.indexOf("viewform") > -1;
      };

      CustomInput.prototype.isEditor = function(url) {
        return url.indexOf("/edit") > -1;
      };

      CustomInput.prototype.launch = function(url) {
        if (this.isViewer(url)) {
          this.loadViewer();
        }
        if (this.isEditor(url)) {
          return this.loadEditor();
        }
      };

      CustomInput.prototype.addType = function(type) {
        if (this.extraInputTypes == null) {
          this.extraInputTypes = new InputTypeList();
        }
        return this.extraInputTypes.push(type);
      };

      CustomInput.prototype.loadViewer = function() {};

      CustomInput.prototype.loadEditor = function() {
        this.editor = new Editor(this);
        this.editor.appendToInsertMenu(this.extraInputTypes);
        this.editor.onFieldSelect((function(_this) {
          return function() {
            return window.setTimeout(_this.populateField, 1000);
          };
        })(this));
        return this.editor.onQuestionTypeDropdown((function(_this) {
          return function(menu) {
            return _this.editor.appendToFieldTypeMenu(menu, _this.extraInputTypes);
          };
        })(this));
      };

      CustomInput.prototype.populateField = function() {
        var field;
        field = this.editor.getCurrentInputType();
        if (!field) {
          return;
        }
        field = this.deserialize(field);
        if (field.custom()) {
          return field.replaceEditor(this.editor);
        }
      };

      CustomInput.prototype.deserialize = function(field) {
        var type, _i, _len, _ref;
        _ref = this.extraInputTypes;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          type = _ref[_i];
          field = type.customChecker(field, type);
        }
        return field;
      };

      return CustomInput;

    })();
    return CustomInput;
  });

}).call(this);
